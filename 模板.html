<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>é€å¸§åŠ¨ç”»å¯¼å‡ºæ¨¡æ¿ï¼ˆæ ‡å‡†é€šç”¨ç‰ˆï¼‰</title>
    <style>
        body { background: #f0f0f0; font-family: sans-serif; padding: 20px; }
        #canvas-container { border: 1px solid #ccc; background: white; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h3>é€å¸§åŠ¨ç”»å¯¼å‡ºæ¨¡æ¿ï¼ˆæ ‡å‡†é€šç”¨ç‰ˆï¼‰</h3>
    <div id="canvas-container"></div>
    <button id="start-btn">å¼€å§‹å¯¼å‡º</button>
    <button id="download-btn" disabled>ä¸‹è½½ ZIP</button>

    <!-- å¿…è¦åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        /********************** 1ï¸ åŸºç¡€é…ç½®åŒºï¼ˆéœ€è¦æ”¹ï¼‰ **********************/
        const CANVAS_WIDTH = 1920;         // ç”»å¸ƒå®½åº¦ï¼Œé»˜è®¤ä¸æ”¹
        const CANVAS_HEIGHT = 1080;        // ç”»å¸ƒé«˜åº¦ï¼Œé»˜è®¤ä¸æ”¹
        const FRAME_RATE = 30;             // å¸§ç‡ï¼Œé»˜è®¤ä¸æ”¹
        const TOTAL_DURATION = 5;          // åŠ¨ç”»æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
        const TOTAL_FRAMES = Math.ceil(TOTAL_DURATION * FRAME_RATE);

        /********************** 2ï¸ åŠ¨ç”»å…ƒç´ å®šä¹‰åŒºï¼ˆéœ€è¦æ”¹ï¼‰ **********************/
        // ä½ å¯ä»¥å®šä¹‰ä»»æ„å…ƒç´ 
        const textObj = {
            x: CANVAS_WIDTH / 2,
            y: CANVAS_HEIGHT / 2,
            fontSize: 100,
            text: 'ğŸš€ å¯åŠ¨ï¼',
            opacity: 1
        };

        /********************** 3ï¸ åŠ¨ç”» timeline å®šä¹‰åŒºï¼ˆéœ€è¦æ”¹ï¼‰ **********************/
        const timeline = gsap.timeline({ paused: true })
            .to(textObj, { x: 1600, duration: 3, ease: 'power2.inOut' })         // æ¨ªå‘ç§»åŠ¨
            .to(textObj, { fontSize: 200, duration: 2, ease: 'elastic.out' }, 1) // å­—ä½“å˜å¤§
            .to(textObj, { opacity: 0, duration: 1 }, 4);                        // æ·¡å‡º

        /********************** 4ï¸ drawScene å‡½æ•°ï¼ˆæ¯æ¬¡åŠ¨ç”»è‡ªå®šä¹‰ï¼‰ **********************/
        const drawScene = () => {
            // ğŸ‘‰ æ¯æ¬¡åŠ¨ç”»è‡ªå·±å®šä¹‰è¿™é‡Œç”»ä»€ä¹ˆ
            ctx.globalAlpha = textObj.opacity;
            ctx.font = `${textObj.fontSize}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#000';
            ctx.fillText(textObj.text, textObj.x, textObj.y);
            ctx.globalAlpha = 1;
        };

        /********************** 5ï¸ æ ¸å¿ƒé€»è¾‘åŒºï¼ˆæ— éœ€æ”¹ï¼Œé€šç”¨æ¨¡æ¿ï¼‰ **********************/
        // åˆå§‹åŒ– canvas
        const canvas = document.createElement('canvas');
        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HEIGHT;
        document.getElementById('canvas-container').appendChild(canvas);
        const ctx = canvas.getContext('2d');

        // é€å¸§å¯¼å‡ºç›¸å…³å˜é‡
        let currentFrame = 0;
        let isExporting = false;
        const frameImages = [];

        // å›ºå®šæ¨¡æ¿ drawFrame â†’ å§‹ç»ˆè°ƒç”¨ drawScene
        const drawFrame = () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';  // èƒŒæ™¯è‰²ï¼ˆå¯æ”¹é€æ˜è‰² 'rgba(0,0,0,0)' æ”¯æŒé€æ˜PNGï¼‰
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // è°ƒç”¨è‡ªå®šä¹‰ç»˜åˆ¶é€»è¾‘
            drawScene();
        };

        // å¯¼å‡ºå½“å‰å¸§
        const exportFrame = () => {
            const progress = currentFrame / TOTAL_FRAMES;
            timeline.progress(progress);
            drawFrame();

            const dataURL = canvas.toDataURL('image/png');
            frameImages.push(dataURL);

            currentFrame++;
            if (currentFrame < TOTAL_FRAMES) {
                setTimeout(exportFrame, 1000 / FRAME_RATE);
            } else {
                isExporting = false;
                document.getElementById('download-btn').disabled = false;
                console.log(`å¯¼å‡ºå®Œæˆï¼Œå…± ${frameImages.length} å¸§`);
            }
        };

        // æŒ‰é’®ç»‘å®šé€»è¾‘
        document.getElementById('start-btn').addEventListener('click', () => {
            if (isExporting) return;
            isExporting = true;
            currentFrame = 0;
            frameImages.length = 0;
            document.getElementById('download-btn').disabled = true;
            exportFrame();
        });

        document.getElementById('download-btn').addEventListener('click', () => {
            const zip = new JSZip();
            frameImages.forEach((dataURL, index) => {
                const base64 = dataURL.split(',')[1];
                zip.file(`frame_${String(index).padStart(4, '0')}.png`, base64, { base64: true });
            });

            zip.generateAsync({ type: 'blob' }).then((blob) => {
                saveAs(blob, 'frames.zip');
                console.log('æ‰€æœ‰å¸§å·²æ‰“åŒ…ä¸‹è½½');
            });
        });
    </script>
</body>
</html>
